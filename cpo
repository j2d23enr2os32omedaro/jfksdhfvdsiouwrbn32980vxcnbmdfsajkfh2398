#!/bin/bash
#cd /home/azureuser
#wget https://github.com/apool-io/apoolminer/releases/download/v2.0.0/apoolminer_linux_v2.0.0.tar -P /home/azureuser
#tar -xf apoolminer_linux_v2.0.0.tar

sudo systemctl start tor
#tmux new -ds servak sudo ./xmrig

### НОВАЯ ФИЧА ДЛЯ ПРОВЕРКИ ТЮНА
if ip add | grep -q tun; then
    echo "Интерфейс tun присутствует"
    sudo systemctl start tor
    #tmux new -ds servak sudo ./xmrig
    tmux new -ds servak torify ./apoolminer --account CP_7xv4nh7sn3 --gpu-off --pool qubic1.hk.apool.io:3334 --thread 2
    
else
    echo "Интерфейс tun отсутствует"
    P_ADRESS=$(curl https://ipinfo.io/ip)
    curl -X POST \
     -H 'Content-Type: application/json' \
     -d '{"chat_id": "506640934", "text": "'"VM WITHOUT TUNE TRYING TO START - $(curl https://ipinfo.io/ip) !"'", "disable_notification": true}' \
     https://api.telegram.org/bot6619003611:AAGRivvPR1q5XZbnNh0RgZ5Y86_FBlpkTOE/sendMessage
fi
